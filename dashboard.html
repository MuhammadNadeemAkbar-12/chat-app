<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>User Dashboard</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<!-- Bootstrap Icons -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background-color: #f5f5f5;
				overflow-x: hidden;
			}
			body.dark {
				background-color: #12181f;
			}

			.sidebar {
				background-color: #2c3e50;
				color: white;
				height: 100vh;
				position: fixed;
				width: 250px;
				z-index: 1000;
				transition: all 0.3s;
				left: 0;
			}

			.main-content {
				margin-left: 250px;
				padding: 20px;
				transition: all 0.3s;
			}

			.chat-container {
				background-color: white;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				height: calc(100vh - 120px);
				display: flex;
				flex-direction: column;
			}
			body.dark .chat-container {
				background-color: #1e2732;
				box-shadow: 0 0 12px rgba(0, 0, 0, 0.4);
			}

			/* Hamburger menu button */
			.hamburger-btn {
				display: none;
				position: fixed;
				top: 10px;
				left: 10px;
				z-index: 1100;
				background: #3498db;
				color: white;
				border: none;
				border-radius: 5px;
				padding: 8px 12px;
				font-size: 1.2rem;
			}

			/* Responsive adjustments */
			@media (max-width: 992px) {
				.sidebar {
					left: -250px;
				}

				.sidebar.active {
					left: 0;
				}

				.main-content {
					margin-left: 0;
					padding-top: 60px; /* Add space for hamburger button */
				}

				.hamburger-btn {
					display: block;
				}

				.chat-container {
					height: calc(100vh - 160px);
				}
			}

			/* Rest of your existing styles... */
			.chat-header {
				padding: 12px 18px;
				border-bottom: 1px solid #eee;
				background: linear-gradient(135deg, #3498db, #1d6fa8);
				color: white;
				border-radius: 10px 10px 0 0;
			}
			body.dark .chat-header {
				background: linear-gradient(135deg, #1d6fa8, #143d55);
				border-color: #233445;
			}

			.chat-messages {
				flex: 1;
				overflow-y: auto;
				padding: 15px;
				scroll-behavior: smooth;
			}
			.chat-messages::-webkit-scrollbar {
				width: 8px;
			}
			.chat-messages::-webkit-scrollbar-track {
				background: transparent;
			}
			.chat-messages::-webkit-scrollbar-thumb {
				background: #c5c5c5;
				border-radius: 4px;
			}
			body.dark .chat-messages::-webkit-scrollbar-thumb {
				background: #395167;
			}

			.chat-input {
				padding: 12px 15px;
				border-top: 1px solid #eee;
			}
			body.dark .chat-input {
				border-color: #233445;
			}
			.chat-input textarea {
				resize: none;
				max-height: 160px;
				min-height: 48px;
				padding: 10px 12px;
			}
			body.dark .chat-input textarea {
				background: #243140;
				color: #e8f1f7;
				border-color: #2f4256;
			}
			body.dark .chat-input textarea:focus {
				border-color: #3498db;
				box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.25);
			}

			.user-list {
				list-style: none;
				padding: 0;
				margin: 0;
			}

			.user-list li {
				padding: 10px 15px;
				cursor: pointer;
				border-bottom: 1px solid #3d5166;
			}

			.user-list li:hover {
				background-color: #3d5166;
			}
			.user-list li.active-contact {
				background: #1abc9c;
				color: #fff;
			}
			body.dark .user-list li {
				border-bottom-color: #33485b;
			}
			body.dark .user-list li:hover {
				background: #3d5166;
			}
			body.dark .user-list li.active-contact {
				background: #0f8d73;
			}

			.message {
				margin-bottom: 12px;
				padding: 10px 15px;
				border-radius: 8px;
				max-width: 75%;
				position: relative;
				word-wrap: break-word;
			}

			.sent {
				background-color: #3498db;
				color: white;
				margin-left: auto;
			}
			body.dark .sent {
				background: #1d6fa8;
			}

			.received {
				background-color: #f1f1f1;
				margin-right: auto;
			}
			body.dark .received {
				background: #2a3a49;
				color: #e2ecf3;
			}

			.message-time {
				font-size: 0.7rem;
				opacity: 0.8;
				text-align: right;
				margin-top: 3px;
			}

			.sender-name {
				font-weight: bold;
				margin-bottom: 2px;
				color: #555;
			}

			.last-message-time {
				font-size: 0.8rem;
			}

			@media (max-width: 576px) {
				.message {
					max-width: 90%;
				}

				.main-content {
					padding: 10px;
					padding-top: 60px;
				}

				.chat-header h5 {
					font-size: 1rem;
				}
			}
			.theme-toggle-btn {
				border: none;
				background: rgba(255, 255, 255, 0.25);
				color: #fff;
				padding: 6px 10px;
				border-radius: 6px;
			}
			.theme-toggle-btn:hover {
				background: rgba(255, 255, 255, 0.35);
			}
			body.dark .theme-toggle-btn {
				background: rgba(255, 255, 255, 0.08);
			}
			body.dark .theme-toggle-btn:hover {
				background: rgba(255, 255, 255, 0.15);
			}
		</style>
	</head>

	<body>
		<button class="hamburger-btn" id="hamburgerBtn">
			<i class="bi bi-list"></i>
		</button>

		<div class="sidebar" id="sidebar">
			<div class="p-3">
				<h4>Chat App</h4>
				<p id="current-user" class="mb-4"></p>
			</div>
			<div class="p-3">
				<button
					class="btn btn-primary w-100 mb-3"
					data-bs-toggle="modal"
					data-bs-target="#addUserModal">
					Add User
				</button>
				<h5>Contacts</h5>
				<ul class="user-list" id="contacts-list"></ul>
			</div>
		</div>

		<div class="main-content" id="mainContent">
			<div class="chat-container">
				<div
					class="chat-header d-flex justify-content-between align-items-center gap-2 flex-wrap">
					<h5 id="chat-with-user" class="mb-0">Select a user to chat</h5>
					<div class="d-flex align-items-center gap-2">
						<button
							class="theme-toggle-btn"
							id="dashThemeToggle"
							title="Toggle theme">
							<i class="bi bi-moon-fill" id="dashThemeIcon"></i>
						</button>
						<button class="btn btn-sm btn-light" id="logout-btn">Logout</button>
					</div>
				</div>
				<div class="chat-messages d-flex flex-column" id="chat-messages"></div>
				<div class="chat-input">
					<div class="d-flex gap-2 align-items-end">
						<textarea
							class="form-control"
							id="message-input"
							placeholder="Type your message..."
							disabled
							rows="2"></textarea>
						<button
							class="btn btn-primary"
							id="send-btn"
							disabled
							style="height: 48px">
							Send
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="addUserModal" tabindex="-1">
			<!-- Edit Message Modal -->
			<div
				class="modal fade"
				id="editMessageModal"
				tabindex="-1"
				aria-labelledby="editMessageModalLabel"
				aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="editMessageModalLabel">
								Edit Message
							</h5>
							<button
								type="button"
								class="btn-close"
								data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<textarea
								class="form-control"
								id="editMessageInput"
								rows="3"></textarea>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-bs-dismiss="modal">
								Cancel
							</button>
							<button
								type="button"
								class="btn btn-primary"
								id="saveEditMessageBtn">
								Save
							</button>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Add New User</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<label for="new-user-email" class="form-label">User Email</label>
							<input type="email" class="form-control" id="new-user-email" />
						</div>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal">
							Close
						</button>
						<button type="button" class="btn btn-primary" id="add-user-btn">
							Add User
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			document
				.getElementById("hamburgerBtn")
				.addEventListener("click", function () {
					document.getElementById("sidebar").classList.toggle("active");
				});

			document.addEventListener("click", function (event) {
				const sidebar = document.getElementById("sidebar");
				const hamburgerBtn = document.getElementById("hamburgerBtn");

				if (
					window.innerWidth <= 992 &&
					!sidebar.contains(event.target) &&
					event.target !== hamburgerBtn &&
					!hamburgerBtn.contains(event.target)
				) {
					sidebar.classList.remove("active");
				}
			});

			document
				.getElementById("contacts-list")
				.addEventListener("click", function () {
					if (window.innerWidth <= 992) {
						document.getElementById("sidebar").classList.remove("active");
					}
				});
		</script>
		<script src="./Javascript/dash.js"></script>
		<script>
			// Dashboard theme toggle (shared preference with other pages)
			(function () {
				const body = document.body;
				const btn = document.getElementById("dashThemeToggle");
				const icon = document.getElementById("dashThemeIcon");
				function applyTheme(mode) {
					body.classList.toggle("dark", mode === "dark");
					icon.className =
						mode === "dark" ? "bi bi-sun-fill" : "bi bi-moon-fill";
					localStorage.setItem("theme", mode);
				}
				const saved =
					localStorage.getItem("theme") ||
					(window.matchMedia("(prefers-color-scheme: dark)").matches
						? "dark"
						: "light");
				applyTheme(saved);
				btn.addEventListener("click", () => {
					const next = body.classList.contains("dark") ? "light" : "dark";
					applyTheme(next);
				});
			})();
		</script>
	</body>
</html>
